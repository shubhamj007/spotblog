!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","@angular/common","@angular/core","rxjs","rxjs/operators"],t):t((e=e||self)["ng-lazyload-image"]={},e.ng.common,e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,r,o){"use strict";function i(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function s(e,t){return function(n,r){t(n,r,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var u="ng-lazyloaded",c="ng-failed-lazyloaded";function l(e,t){e.className.includes(t)||(e.className+=" "+t)}function f(){return"undefined"!=typeof window?window.navigator:void 0}function p(e){return Boolean(e.parentElement&&"picture"===e.parentElement.nodeName.toLowerCase())}function m(e){return"img"===e.nodeName.toLowerCase()}function d(e,t,n){return m(e)?n&&"srcset"in e?e.srcset=t:e.src=t:e.style.backgroundImage="url('"+t+"')",e}function g(e){return function(t){for(var n=t.parentElement.getElementsByTagName("source"),r=0;r<n.length;r++){var o=n[r].getAttribute(e);o&&("srcset"in n[r]?n[r].srcset=o:n[r].src=o)}}}var h=g("defaultImage"),b=g("lazyLoad"),v=g("errorImage");function y(e){return function(t,n,r){m(t)&&p(t)&&e(t),n&&d(t,n,r)}}var I=y(h),O=y(b),w=y(v),j={finally:function(e){return l(e.element,u)},loadImage:function(e){var t,n=e.element,r=e.useSrcset,o=e.imagePath,i=e.decode;if(m(n)&&p(n)){var s=n.parentNode.cloneNode(!0);t=s.getElementsByTagName("img")[0],b(t),d(t,o,r)}else t=new Image,m(n)&&n.sizes&&(t.sizes=n.sizes),r&&"srcset"in t?t.srcset=o:t.src=o;return i&&t.decode?t.decode().then(function(){return o}):new Promise(function(e,n){t.onload=function(){return e(o)},t.onerror=function(){return n(null)}})},setErrorImage:function(e){var t=e.element,n=e.errorImagePath,r=e.useSrcset;w(t,n,r),l(t,c)},setLoadedImage:function(e){var t=e.element,n=e.imagePath,r=e.useSrcset;O(t,n,r)},setup:function(e){var t=e.element,n=e.defaultImagePath,r=e.useSrcset;I(t,n,r),function(e,t){return e.className&&e.className.includes(t)}(t,u)&&function(e,t){e.className=e.className.replace(t,"")}(t,u)},isBot:function(e){return!(!e||!e.userAgent)&&/googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|duckduckbot/i.test(e.userAgent)}},E=new WeakMap,S=new r.Subject;function L(e){e.forEach(function(e){return S.next(e)})}var k={},x=function(e){var t=e.scrollContainer||k,n={root:e.scrollContainer||null};e.offset&&(n.rootMargin=e.offset+"px");var i=E.get(t);return i||(i=new IntersectionObserver(L,n),E.set(t,i)),i.observe(e.element),r.Observable.create(function(t){var n=S.pipe(o.filter(function(t){return t.target===e.element})).subscribe(t);return function(){n.unsubscribe(),i.unobserve(e.element)}})},C=Object.assign({},j,{isVisible:function(e){return e.event.isIntersecting},getObservable:function(e,t){return void 0===t&&(t=x),e.customObservable?e.customObservable:t(e)}}),P=Object.assign({},j,{isVisible:function(){return!0},getObservable:function(){return r.of("load")},loadImage:function(e){return[e.imagePath]}});var N=function(){function e(e,t,o,i){this.onLoad=new n.EventEmitter,this.elementRef=e,this.ngZone=t,this.propertyChanges$=new r.ReplaySubject,this.platformId=o,this.hooks=function(e,t){var n=C,r=t&&t.isBot?t.isBot:n.isBot;if(r(f(),e))return Object.assign(P,{isBot:r});if(!t)return n;var o={};return t.preset?Object.assign(o,t.preset):Object.assign(o,n),Object.keys(t).filter(function(e){return"preset"!==e}).forEach(function(e){o[e]=t[e]}),o}(o,i)}return e.prototype.ngOnChanges=function(){this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:this.offset?0|this.offset:0,scrollContainer:this.scrollTarget,customObservable:this.customObservable,decode:this.decode})},e.prototype.ngAfterContentInit=function(){var e=this;if(t.isPlatformServer(this.platformId)&&!this.hooks.isBot(f(),this.platformId))return null;this.ngZone.runOutsideAngular(function(){e.scrollSubscription=e.propertyChanges$.pipe(o.tap(function(t){return e.hooks.setup(t)}),o.switchMap(function(t){return e.hooks.getObservable(t).pipe(function(e,t){return function(n){return n.pipe(o.filter(function(n){return e.isVisible({element:t.element,event:n,offset:t.offset,scrollContainer:t.scrollContainer})}),o.take(1),o.mergeMap(function(){return e.loadImage(t)}),o.tap(function(n){return e.setLoadedImage({element:t.element,imagePath:n,useSrcset:t.useSrcset})}),o.map(function(){return!0}),o.catchError(function(){return e.setErrorImage(t),r.of(!1)}),o.tap(function(){return e.finally(t)}))}}(e.hooks,t))})).subscribe(function(t){return e.onLoad.emit(t)})})},e.prototype.ngOnDestroy=function(){this.scrollSubscription&&this.scrollSubscription.unsubscribe()},i([n.Input("lazyLoad"),a("design:type",String)],e.prototype,"lazyImage",void 0),i([n.Input(),a("design:type",String)],e.prototype,"defaultImage",void 0),i([n.Input(),a("design:type",String)],e.prototype,"errorImage",void 0),i([n.Input(),a("design:type",Object)],e.prototype,"scrollTarget",void 0),i([n.Input(),a("design:type",r.Observable)],e.prototype,"customObservable",void 0),i([n.Input(),a("design:type",Number)],e.prototype,"offset",void 0),i([n.Input(),a("design:type",Boolean)],e.prototype,"useSrcset",void 0),i([n.Input(),a("design:type",Boolean)],e.prototype,"decode",void 0),i([n.Output(),a("design:type",n.EventEmitter)],e.prototype,"onLoad",void 0),e=i([n.Directive({selector:"[lazyLoad]"}),s(2,n.Inject(n.PLATFORM_ID)),s(3,n.Optional()),s(3,n.Inject("options")),a("design:paramtypes",[n.ElementRef,n.NgZone,Object,Object])],e)}(),z=function(){function e(){}var t;return t=e,e.forRoot=function(e){return{ngModule:t,providers:[{provide:"options",useValue:e}]}},e=t=i([n.NgModule({declarations:[N],exports:[N]})],e)}(),M=function(){function e(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}return e.fromElement=function(t){var n=t.getBoundingClientRect(),r=n.left,o=n.top,i=n.right,s=n.bottom;return 0===r&&0===o&&0===i&&0===s?e.empty:new e(r,o,i,s)},e.fromWindow=function(t){return new e(0,0,t.innerWidth,t.innerHeight)},e.prototype.inflate=function(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e},e.prototype.intersectsWith=function(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom},e.prototype.getIntersectionWith=function(t){var n=Math.max(this.left,t.left),r=Math.max(this.top,t.top),o=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom);return o>=n&&i>=r?new e(n,r,o,i):e.empty},e.empty=new e(0,0,0,0),e}(),R=new WeakMap;var W=function(e){if(!e||"function"!=typeof e.addEventListener)return console.warn("`addEventListener` on "+e+" (scrollTarget) is not a function. Skipping this target"),r.empty();var t=R.get(e);if(t)return t;var n,i=r.Observable.create(function(t){var n=function(e){return t.next(e)},r={passive:!0,capture:!1};return e.addEventListener("scroll",n,r),function(){return e.removeEventListener("scroll",n,r)}}),s=i.pipe(o.sampleTime(100,n),o.share(),o.startWith(""));return R.set(e,s),s},B=Object.assign({},j,{isVisible:function(e,t){var n=e.element,r=e.offset,o=e.scrollContainer;void 0===t&&(t=function(){return window});var i=M.fromElement(n);if(i===M.empty)return!1;var s=M.fromWindow(t());if(i.inflate(r),o){var a=M.fromElement(o).getIntersectionWith(s);return i.intersectsWith(a)}return i.intersectsWith(s)},getObservable:function(e){return e.customObservable?e.customObservable.pipe(o.startWith("")):e.scrollContainer?W(e.scrollContainer):W(window)}});e.LazyLoadImageDirective=N,e.LazyLoadImageModule=z,e.intersectionObserverPreset=C,e.scrollPreset=B,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map