import { of } from 'rxjs';
import { catchError, filter, map, mergeMap, take, tap } from 'rxjs/operators';
export function lazyLoadImage(hookSet, attributes) {
    return (evntObservable) => {
        return evntObservable.pipe(filter(event => hookSet.isVisible({
            element: attributes.element,
            event: event,
            offset: attributes.offset,
            scrollContainer: attributes.scrollContainer
        })), take(1), mergeMap(() => hookSet.loadImage(attributes)), tap(imagePath => hookSet.setLoadedImage({
            element: attributes.element,
            imagePath,
            useSrcset: attributes.useSrcset
        })), map(() => true), catchError(() => {
            hookSet.setErrorImage(attributes);
            return of(false);
        }), tap(() => hookSet.finally(attributes)));
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF6eWxvYWQtaW1hZ2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1sYXp5bG9hZC1pbWFnZS8iLCJzb3VyY2VzIjpbInNyYy9sYXp5bG9hZC1pbWFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzlFLE1BQU0sVUFBVSxhQUFhLENBQUksT0FBbUIsRUFBRSxVQUFzQjtJQUMxRSxPQUFPLENBQUMsY0FBNkIsRUFBRSxFQUFFO1FBQ3ZDLE9BQU8sY0FBYyxDQUFDLElBQUksQ0FDeEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQ2IsT0FBTyxDQUFDLFNBQVMsQ0FBQztZQUNoQixPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU87WUFDM0IsS0FBSyxFQUFFLEtBQUs7WUFDWixNQUFNLEVBQUUsVUFBVSxDQUFDLE1BQU07WUFDekIsZUFBZSxFQUFFLFVBQVUsQ0FBQyxlQUFlO1NBQzVDLENBQUMsQ0FDSCxFQUNELElBQUksQ0FBQyxDQUFDLENBQUMsRUFDUCxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUM3QyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FDZCxPQUFPLENBQUMsY0FBYyxDQUFDO1lBQ3JCLE9BQU8sRUFBRSxVQUFVLENBQUMsT0FBTztZQUMzQixTQUFTO1lBQ1QsU0FBUyxFQUFFLFVBQVUsQ0FBQyxTQUFTO1NBQ2hDLENBQUMsQ0FDSCxFQUNELEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFDZixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsT0FBTyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNsQyxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsRUFDRixHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUN2QyxDQUFDO0lBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBmaWx0ZXIsIG1hcCwgbWVyZ2VNYXAsIHRha2UsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEF0dHJpYnV0ZXMsIEhvb2tTZXQgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGxhenlMb2FkSW1hZ2U8RT4oaG9va1NldDogSG9va1NldDxFPiwgYXR0cmlidXRlczogQXR0cmlidXRlcykge1xuICByZXR1cm4gKGV2bnRPYnNlcnZhYmxlOiBPYnNlcnZhYmxlPEU+KSA9PiB7XG4gICAgcmV0dXJuIGV2bnRPYnNlcnZhYmxlLnBpcGUoXG4gICAgICBmaWx0ZXIoZXZlbnQgPT5cbiAgICAgICAgaG9va1NldC5pc1Zpc2libGUoe1xuICAgICAgICAgIGVsZW1lbnQ6IGF0dHJpYnV0ZXMuZWxlbWVudCxcbiAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgb2Zmc2V0OiBhdHRyaWJ1dGVzLm9mZnNldCxcbiAgICAgICAgICBzY3JvbGxDb250YWluZXI6IGF0dHJpYnV0ZXMuc2Nyb2xsQ29udGFpbmVyXG4gICAgICAgIH0pXG4gICAgICApLFxuICAgICAgdGFrZSgxKSxcbiAgICAgIG1lcmdlTWFwKCgpID0+IGhvb2tTZXQubG9hZEltYWdlKGF0dHJpYnV0ZXMpKSxcbiAgICAgIHRhcChpbWFnZVBhdGggPT5cbiAgICAgICAgaG9va1NldC5zZXRMb2FkZWRJbWFnZSh7XG4gICAgICAgICAgZWxlbWVudDogYXR0cmlidXRlcy5lbGVtZW50LFxuICAgICAgICAgIGltYWdlUGF0aCxcbiAgICAgICAgICB1c2VTcmNzZXQ6IGF0dHJpYnV0ZXMudXNlU3Jjc2V0XG4gICAgICAgIH0pXG4gICAgICApLFxuICAgICAgbWFwKCgpID0+IHRydWUpLFxuICAgICAgY2F0Y2hFcnJvcigoKSA9PiB7XG4gICAgICAgIGhvb2tTZXQuc2V0RXJyb3JJbWFnZShhdHRyaWJ1dGVzKTtcbiAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcbiAgICAgIH0pLFxuICAgICAgdGFwKCgpID0+IGhvb2tTZXQuZmluYWxseShhdHRyaWJ1dGVzKSlcbiAgICApO1xuICB9O1xufVxuIl19